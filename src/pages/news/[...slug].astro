---
import HtmlBase from "@layouts/HtmlBase.astro";
import type { GetStaticPathsResult } from "astro";
import { CollectionEntry, getCollection } from "astro:content";
import GenericTest from "@assets/images/generic-test.png";
import { Image } from "astro:assets";

export async function getStaticPaths(): Promise<GetStaticPathsResult> {
  const articles = (await getCollection("news")).filter(
    (a) => !a.data.draft || process.env.NODE_ENV === "development"
  );
  return articles.map((article) => ({
    params: {
      slug: article.slug,
    },
    props: {
      article,
    },
  }));
}

export interface Props {
  article: CollectionEntry<"news">;
}

const { article } = Astro.props;
const { Content } = await article.render();
---

<style is:global>
  article img {
    @apply w-full max-w-2xl sm:rounded-xl;
  }
  article a.img-link {
    @apply overflow-clip sm:hover:scale-102 sm:active:(scale-101 duration-0) transition-transform w-[calc(100%+1rem)] items-center flex flex-col -mx-2 sm:(w-full mx-0 mb-2);
  }
  article a.heading-link h1,h2,h3,h4,h5,h6 {
    @apply after:(content-['#'] text-blue underline hover:opacity-100 opacity-0 transition-opacity duration-50);
  }
  article h1 {
    @apply text-4xl font-bold mt-6 mb-4;
  }
  article h2 {
    @apply text-3xl font-bold mt-5 mb-3;
  }
  article h3 {
    @apply text-2xl font-bold mt-4 mb-2;
  }
  article h4 {
    @apply text-xl font-bold mt-3 mb-1;
  }
  article h5 {
    @apply text-lg font-bold mt-2;
  }
  article h6 {
    @apply text-base font-bold mt-1;
  }
  article {
    font-size: 100%;
  }
  article p {
    @apply mb-4;
  }
</style>
<HtmlBase title={article.data.title} description={article.data.description} image={article.data.image} imageCard type="article">
  <main class="flex flex-col items-center w-full sm:p-2">
    <div class="mb-4 w-full max-w-5xl">
      <div class="hidden md:block mb-4 px-2">
        <h1 class="font-bold text-5xl">
          {article.data.title}
        </h1>
        <div class="text-sm font-medium">{article.data.date.toISOString().split('T')[0]}</div>
      </div>
      <Image
        src={article.data.image ?? GenericTest}
        alt={article.data.title}
        loading="eager"
        width={1024}
        quality="max"
        class="sm:rounded-xl w-full"
      />
      <div class="md:hidden px-2">
        <h1 class=" font-bold text-3xl sm:text-4xl">
          {article.data.title}
        </h1>
        <div class="text-sm font-medium">{article.data.date.toISOString().split('T')[0]}</div>
      </div>
    </div>

    <article class="w-full max-w-3xl flex px-2">
      <Content />
    </article>
  </main>
</HtmlBase>
